!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("es6-promise"),require("fetch-ponyfill"),require("pubnub")):"function"==typeof define&&define.amd?define([,,"pubnub"],t):"object"==typeof exports?exports.SDK=t(require("es6-promise"),require("fetch-ponyfill"),require("pubnub")):(e.RingCentral=e.RingCentral||{},e.RingCentral.SDK=t(e[void 0],e[void 0],e[void 0]))}(this,function(e,t,r){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="/build/",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r(2);var s=r(3),u=o(s),a=r(11),c=n(a),p=r(4),h=o(p),f=r(12),l=n(f),d=r(13),y=n(d),_=r(14),v=n(_),b=r(15),m=n(b),w=r(17),g=n(w),x=r(16),E=n(x),k=r(18),T=n(k),R=r(19),S=n(R),O=r(21),P=n(O),j=r(23),L=n(j),C=r(24),M=n(C),A=r(20),F=n(A),q=function(){function e(t){var r=t.server,n=t.cachePrefix,o=t.appSecret,s=t.appKey,u=t.appName,a=t.appVersion,p=t.pubnubFactory,f=t.client,l=t.redirectUri;if(i(this,e),!h.fetch)throw new Error("Native Fetch is missing, set RingCentral.SDK.core.Externals.fetch to your favorite alternative");if(!h.Promise)throw new Error("Native Promise is missing, set RingCentral.SDK.core.Externals.Promise to your favorite alternative");this._cache=new c.default(h.localStorage,n),this._client=f||new y.default,this._platform=new T.default({client:this._client,cache:this._cache,version:e.version,server:r,appKey:s,appSecret:o,appName:u,appVersion:a,redirectUri:l}),this._pubnubFactory=p||h.PUBNUB}return e.prototype.platform=function(){return this._platform},e.prototype.createSubscription=function(){return new L.default(this._pubnubFactory,this._platform)},e.prototype.createCachedSubscription=function(e){return new M.default(this._pubnubFactory,this._platform,this._cache,e)},e.prototype.cache=function(){return this._cache},e.handleLoginRedirect=function(e){var t,r=window.location.hash?window.location.hash:window.location.search;window.opener.postMessage((t={},t[F.default.authResponseProperty]=r,t),e||window.location.origin)},e}();q.version=F.default.version,q.server={sandbox:"https://platform.devtest.ringcentral.com",production:"https://platform.ringcentral.com"},q.core={Cache:c.default,EventEmitter:l.default,Utils:u,Externals:h},q.http={Client:y.default,ApiResponse:v.default},q.platform={Auth:S.default,Platform:T.default},q.subscription={Subscription:L.default},q.mocks={Client:m.default,Registry:E.default,Mock:g.default},q.pubnub={PubnubMockFactory:P.default},e.exports=q},function(e,t){(function(t){!function(t){"use strict";function r(e,t,r,n){var i=Object.create((t||o).prototype),s=new l(n||[]);return i._invoke=p(e,r,s),i}function n(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function o(){}function i(){}function s(){}function u(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function a(e){this.arg=e}function c(e){function t(t,r){var n=e[t](r),s=n.value;return s instanceof a?Promise.resolve(s.arg).then(o,i):Promise.resolve(s).then(function(e){return n.value=e,n})}function r(e,r){function o(){return t(e,r)}return n=n?n.then(o,o):new Promise(function(e){e(o())})}"object"==typeof process&&process.domain&&(t=process.domain.bind(t));var n,o=t.bind(e,"next"),i=t.bind(e,"throw");t.bind(e,"return");this._invoke=r}function p(e,t,r){var o=g;return function(i,s){if(o===E)throw new Error("Generator is already running");if(o===k){if("throw"===i)throw s;return y()}for(;;){var u=r.delegate;if(u){if("return"===i||"throw"===i&&u.iterator[i]===_){r.delegate=null;var a=u.iterator.return;if(a){var c=n(a,u.iterator,s);if("throw"===c.type){i="throw",s=c.arg;continue}}if("return"===i)continue}var c=n(u.iterator[i],u.iterator,s);if("throw"===c.type){r.delegate=null,i="throw",s=c.arg;continue}i="next",s=_;var p=c.arg;if(!p.done)return o=x,p;r[u.resultName]=p.value,r.next=u.nextLoc,r.delegate=null}if("next"===i)r._sent=s,o===x?r.sent=s:r.sent=_;else if("throw"===i){if(o===g)throw o=k,s;r.dispatchException(s)&&(i="next",s=_)}else"return"===i&&r.abrupt("return",s);o=E;var c=n(e,t,r);if("normal"===c.type){o=r.done?k:x;var p={value:c.arg,done:r.done};if(c.arg!==T)return p;r.delegate&&"next"===i&&(s=_)}else"throw"===c.type&&(o=k,i="throw",s=c.arg)}}}function h(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function f(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function l(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(h,this),this.reset(!0)}function d(e){if(e){var t=e[b];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(v.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=_,t.done=!0,t};return n.next=n}}return{next:y}}function y(){return{value:_,done:!0}}var _,v=Object.prototype.hasOwnProperty,b="function"==typeof Symbol&&Symbol.iterator||"@@iterator",m="object"==typeof e,w=t.regeneratorRuntime;if(w)return void(m&&(e.exports=w));w=t.regeneratorRuntime=m?e.exports:{},w.wrap=r;var g="suspendedStart",x="suspendedYield",E="executing",k="completed",T={},R=s.prototype=o.prototype;i.prototype=R.constructor=s,s.constructor=i,i.displayName="GeneratorFunction",w.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===i||"GeneratorFunction"===(t.displayName||t.name))},w.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):e.__proto__=s,e.prototype=Object.create(R),e},w.awrap=function(e){return new a(e)},u(c.prototype),w.async=function(e,t,n,o){var i=new c(r(e,t,n,o));return w.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},u(R),R[b]=function(){return this},R.toString=function(){return"[object Generator]"},w.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},w.values=d,l.prototype={constructor:l,reset:function(e){if(this.prev=0,this.next=0,this.sent=_,this.done=!1,this.delegate=null,this.tryEntries.forEach(f),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=_)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return i.type="throw",i.arg=e,r.next=t,!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],i=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var s=v.call(o,"catchLoc"),u=v.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&v.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?this.next=o.finallyLoc:this.complete(i),T},complete:function(e,t){if("throw"===e.type)throw e.arg;"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=e.arg,this.next="end"):"normal"===e.type&&t&&(this.next=t)},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),f(r),T}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;f(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:d(e),resultName:t,nextLoc:r},T}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(t,function(){return this}())},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return v.default.stringify(e)}function i(e){return v.default.parse(e)}function s(e){return"function"==typeof e}function u(e){return Array.isArray?Array.isArray(e):"array"==typeof e}function a(e){return null!=e&&"object"===("undefined"==typeof e?"undefined":d(e))&&!u(e)}function c(e){return a(e)===!0&&"[object Object]"===Object.prototype.toString.call(e)}function p(e){var t,r;return c(e)!==!1&&(t=e.constructor,"function"==typeof t&&(r=t.prototype,c(r)!==!1&&r.hasOwnProperty("isPrototypeOf")!==!1))}function h(){return"undefined"!=typeof process}function f(){return"undefined"!=typeof window}function l(e){return new y.Promise(function(t,r){setTimeout(function(){t(null)},e)})}t.__esModule=!0;var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.queryStringify=o,t.parseQueryString=i,t.isFunction=s,t.isArray=u,t.isObject=a,t.isObjectObject=c,t.isPlainObject=p,t.isNodeJS=h,t.isBrowser=f,t.delay=l;var y=r(4),_=r(8),v=n(_)},function(e,t,r){(function(e){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.localStorage=t.PUBNUB=t.Headers=t.Response=t.Request=t.fetch=t.Promise=void 0;var o=r(5),i=n(o),s=r(6),u=n(s),a=r(7),c=n(a),p="undefined"!=typeof window&&window||"undefined"!=typeof e&&e||Function("return this;")(),h=i.default&&i.default.Promise||p.Promise,f=u.default?(0,u.default)({Promise:h}):{},l=f.fetch||p.fetch,d=f.Request||p.Request,y=f.Response||p.Response,_=f.Headers||p.Headers,v=c.default||p.PUBNUB,b="undefined"!=typeof p.localStorage?p.localStorage:{};t.Promise=h,t.fetch=l,t.Request=d,t.Response=y,t.Headers=_,t.PUBNUB=v,t.localStorage=b}).call(t,function(){return this}())},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t,r){"use strict";t.decode=t.parse=r(9),t.encode=t.stringify=r(10)},function(e,t){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,o){t=t||"&",n=n||"=";var i={};if("string"!=typeof e||0===e.length)return i;var s=/\+/g;e=e.split(t);var u=1e3;o&&"number"==typeof o.maxKeys&&(u=o.maxKeys);var a=e.length;u>0&&a>u&&(a=u);for(var c=0;c<a;++c){var p,h,f,l,d=e[c].replace(s,"%20"),y=d.indexOf(n);y>=0?(p=d.substr(0,y),h=d.substr(y+1)):(p=d,h=""),f=decodeURIComponent(p),l=decodeURIComponent(h),r(i,f)?Array.isArray(i[f])?i[f].push(l):i[f]=[i[f],l]:i[f]=l}return i}},function(e,t){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,o){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map(function(o){var i=encodeURIComponent(r(o))+n;return Array.isArray(e[o])?e[o].map(function(e){return i+encodeURIComponent(r(e))}).join(t):i+encodeURIComponent(r(e[o]))}).join(t):o?encodeURIComponent(r(o))+n+encodeURIComponent(r(e)):""}},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var n=function(){function e(t,n){r(this,e),this.setPrefix(n),this._storage=t}return e.prototype.setPrefix=function(t){return this._prefix=t||e.defaultPrefix,this},e.prototype.setItem=function(e,t){return this._storage[this._prefixKey(e)]=JSON.stringify(t),this},e.prototype.removeItem=function(e){return delete this._storage[this._prefixKey(e)],this},e.prototype.getItem=function(e){var t=this._storage[this._prefixKey(e)];return t?JSON.parse(t):null},e.prototype.clean=function(){for(var e in this._storage)this._storage.hasOwnProperty(e)&&0===e.indexOf(this._prefix)&&delete this._storage[e];return this},e.prototype._prefixKey=function(e){return this._prefix+e},e}();n.defaultPrefix="rc-",t.default=n},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function o(e){return"number"==typeof e}function i(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,o,u,a,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var p=new Error('Uncaught, unspecified "error" event. ('+t+")");throw p.context=t,p}if(r=this._events[e],s(r))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),r.apply(this,u)}else if(i(r))for(u=Array.prototype.slice.call(arguments,1),c=r.slice(),o=c.length,a=0;a<o;a++)c[a].apply(this,u);return!0},r.prototype.addListener=function(e,t){var o;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function r(){this.removeListener(e,r),o||(o=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var o=!1;return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var r,o,s,u;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],s=r.length,o=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(r)){for(u=s;u-- >0;)if(r[u]===t||r[u].listener&&r[u].listener===t){o=u;break}if(o<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],n(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,i){try{var s=t[o](i),u=s.value}catch(e){return void r(e)}return s.done?void e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){return e=e.toLowerCase(),Object.keys(t).reduce(function(t,r){return t?t:e==r.toLowerCase()?r:t},null)}t.__esModule=!0,t.findHeaderName=a;var c=r(4),p=r(3),h=r(12),f=n(h),l=r(14),d=n(l),y=function(e){function t(){var r,n,o;i(this,t);for(var u=arguments.length,a=Array(u),c=0;c<u;c++)a[c]=arguments[c];return r=n=s(this,e.call.apply(e,[this].concat(a))),n.events={beforeRequest:"beforeRequest",requestSuccess:"requestSuccess",requestError:"requestError"},o=r,s(n,o)}return u(t,e),t.prototype.sendRequest=function(){function e(e){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new d.default(t),e.prev=1,this.emit(this.events.beforeRequest,r),e.next=5,this._loadResponse(t);case 5:return r._response=e.sent,e.next=8,r._init();case 8:if(r.ok()){e.next=10;break}throw new Error("Response has unsuccessful status");case 10:return this.emit(this.events.requestSuccess,r),e.abrupt("return",r);case 14:throw e.prev=14,e.t0=e.catch(1),e.t0.apiResponse||(e.t0=this.makeError(e.t0,r)),this.emit(this.events.requestError,e.t0),e.t0;case 19:case"end":return e.stop()}},e,this,[[1,14]])}));return e}(),t.prototype._loadResponse=function(){function e(e){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.fetch.call(null,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return e}(),t.prototype.makeError=function(e,t){return e.hasOwnProperty("apiResponse")||e.hasOwnProperty("originalMessage")||(e.apiResponse=t,e.originalMessage=e.message,e.message=t&&t.error(!0)||e.originalMessage),e},t.prototype.createRequest=function(e){if(e=e||{},e.headers=e.headers||{},!e.url)throw new Error("Url is not defined");if(e.method||(e.method="GET"),e.method=e.method.toUpperCase(),e.method&&t._allowedMethods.indexOf(e.method)<0)throw new Error("Method has wrong value: "+e.method);if(e.credentials=e.credentials||"include",e.mode=e.mode||"cors",e.query&&(e.url=e.url+(e.url.indexOf("?")>-1?"&":"?")+(0,p.queryStringify)(e.query)),a("Accept",e.headers)||(e.headers.Accept=d.default._jsonContentType),(0,p.isPlainObject)(e.body)||!e.body){var r=a(d.default._contentType,e.headers);r||(r=d.default._contentType,e.headers[r]=d.default._jsonContentType);var n=e.headers[r];n.indexOf(d.default._jsonContentType)>-1?"GET"!==e.method&&"HEAD"!==e.method||!e.body?e.body=JSON.stringify(e.body):e.body=void 0:n.indexOf(d.default._urlencodedContentType)>-1&&(e.body=(0,p.queryStringify)(e.body))}var o=new c.Request(e.url,e);return o.originalBody=e.body,o},t}(f.default);y._allowedMethods=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"],t.default=y},function(e,t,r){"use strict";function n(e){return function(){var t=e.apply(this,arguments);return new i.Promise(function(e,r){function n(o,s){try{var u=t[o](s),a=u.value}catch(e){return void r(e)}return u.done?void e(a):i.Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=r(4),s=function(){function e(t,r,n){o(this,e),this._request=t,this._response=r,this._text=n,this._json=null,this._multipart=[]}return e.prototype._init=function(){function e(){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isMultipart()&&!this._isJson()){e.next=4;break}return e.next=3,this.response().text();case 3:this._text=e.sent;case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)}));return e}(),e.prototype.response=function(){return this._response},e.prototype.request=function(){return this._request},e.prototype.ok=function(){return this._response&&this._response.ok},e.prototype.text=function(){if(!this._isJson()&&!this._isMultipart())throw new Error("Response is not text");return this._text},e.prototype.json=function(){if(!this._isJson())throw new Error("Response is not JSON");return this._json||(this._json=this._text?JSON.parse(this._text):null),this._json},e.prototype.error=function(e){if(this.ok()&&!e)return null;var t=(this._response&&this._response.status?this._response.status+" ":"")+(this._response&&this._response.statusText?this._response.statusText:"");try{this.json().message&&(t=this.json().message),this.json().error_description&&(t=this.json().error_description),this.json().description&&(t=this.json().description)}catch(e){}return t},e.prototype.multipart=function(){if(!this._isMultipart())throw new Error("Response is not multipart");if(!this._multipart.length){var t=this.text();if(!t)throw new Error("No response body");var r=this._getContentType().match(/boundary=([^;]+)/i)[1];if(!r)throw new Error("Cannot find boundary");var n=t.toString().split(e._boundarySeparator+r);if(""===n[0].trim()&&n.shift(),n[n.length-1].trim()==e._boundarySeparator&&n.pop(),n.length<1)throw new Error("No parts in body");var o=e.create(n.shift(),this._response.status,this._response.statusText).json();this._multipart=n.map(function(t,r){var n=o.response[r].status;return e.create(t,n)})}return this._multipart},e.prototype._isContentType=function(e){return this._getContentType().indexOf(e)>-1},e.prototype._getContentType=function(){return this._response.headers.get(e._contentType)||""},e.prototype._isMultipart=function(){return this._isContentType(e._multipartContentType)},e.prototype._isUrlEncoded=function(){return this._isContentType(e._urlencodedContentType)},e.prototype._isJson=function(){return this._isContentType(e._jsonContentType)},e.create=function(t,r,n){t=t||"",r=r||200,n=n||"OK",t=t.replace(/\r/g,"");var o=new i.Headers,s=t.split(e._bodySeparator),u=s.length>1?s.shift():"";return t=s.length>0?s.join(e._bodySeparator):null,(u||"").split("\n").forEach(function(t){var r=t.trim().split(e._headerSeparator),n=r.shift().trim(),i=r.join(e._headerSeparator).trim();n&&o.append(n,i)}),new e(null,new i.Response(t?t:void 0,{headers:o,status:r,statusText:n}),t)},e}();s._contentType="Content-Type",s._jsonContentType="application/json",s._multipartContentType="multipart/mixed",s._urlencodedContentType="application/x-www-form-urlencoded",s._headerSeparator=":",s._bodySeparator="\n\n",s._boundarySeparator="--",t.default=s},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,i){try{var s=t[o](i),u=s.value}catch(e){return void r(e)}return s.done?void e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=r(16),c=n(a),p=r(13),h=n(p),f=function(e){function t(){i(this,t);var r=s(this,e.call(this));return r._registry=new c.default,r}return u(t,e),t.prototype.registry=function(){return this._registry},t.prototype._loadResponse=function(){function e(e){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._registry.find(t),e.next=3,r.getResponse(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return e}(),t}(h.default);t.default=f},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=r(17),s=n(i),u=function(){function e(){o(this,e),this._mocks=[]}return e.prototype.add=function(e){return this._mocks.push(e),this},e.prototype.clear=function(){return this._mocks=[],this},e.prototype.find=function(e){var t=this._mocks.shift();if(!t)throw new Error("No mock in registry for request "+e.method+" "+e.url);if(!t.test(e))throw new Error("Wrong request "+e.method+" "+e.url+" for expected mock "+t.method()+" "+t.path());return t},e.prototype.apiCall=function(e,t,r,n,o,i){return this.add(new s.default(e,t,r,n,o,i)),this},e.prototype.authentication=function(){return this.apiCall("POST","/restapi/oauth/token",{access_token:"ACCESS_TOKEN",token_type:"bearer",expires_in:3600,refresh_token:"REFRESH_TOKEN",refresh_token_expires_in:60480,scope:"SMS RCM Foo Boo",expireTime:(new Date).getTime()+36e5}),this},e.prototype.logout=function(){return this.apiCall("POST","/restapi/oauth/revoke",{}),this},e.prototype.presenceLoad=function(e){return this.apiCall("GET","/restapi/v1.0/account/~/extension/"+e+"/presence",{uri:"https://platform.ringcentral.com/restapi/v1.0/account/123/extension/"+e+"/presence",extension:{uri:"https://platform.ringcentral.com/restapi/v1.0/account/123/extension/"+e,id:e,extensionNumber:"101"},activeCalls:[],presenceStatus:"Available",telephonyStatus:"Ringing",userStatus:"Available",dndStatus:"TakeAllCalls",extensionId:e}),this},e.prototype.subscribeGeneric=function(e){e=e||54e3;var t=new Date;return this.apiCall("POST","/restapi/v1.0/subscription",{eventFilters:["/restapi/v1.0/account/~/extension/~/presence"],expirationTime:new Date(t.getTime()+1e3*e).toISOString(),expiresIn:e,deliveryMode:{transportType:"PubNub",encryption:!1,address:"123_foo",subscriberKey:"sub-c-foo",secretKey:"sec-c-bar"},id:"foo-bar-baz",creationTime:t.toISOString(),status:"Active",uri:"https://platform.ringcentral.com/restapi/v1.0/subscription/foo-bar-baz"}),this},e.prototype.subscribeOnPresence=function(e,t){e=e||"1";var r=new Date;return this.apiCall("POST","/restapi/v1.0/subscription",{eventFilters:["/restapi/v1.0/account/~/extension/"+e+"/presence"+(t?"?detailedTelephonyState=true":"")],expirationTime:new Date(r.getTime()+54e6).toISOString(),deliveryMode:{transportType:"PubNub",encryption:!0,address:"123_foo",subscriberKey:"sub-c-foo",secretKey:"sec-c-bar",encryptionAlgorithm:"AES",encryptionKey:"VQwb6EVNcQPBhE/JgFZ2zw=="},creationTime:r.toISOString(),id:"foo-bar-baz",status:"Active",uri:"https://platform.ringcentral.com/restapi/v1.0/subscription/foo-bar-baz"}),this},e.prototype.tokenRefresh=function(e){return e?this.apiCall("POST","/restapi/oauth/token",{message:"Wrong token",error_description:"Wrong token",description:"Wrong token"},400):this.apiCall("POST","/restapi/oauth/token",{access_token:"ACCESS_TOKEN_FROM_REFRESH",token_type:"bearer",expires_in:3600,refresh_token:"REFRESH_TOKEN_FROM_REFRESH",refresh_token_expires_in:60480,scope:"SMS RCM Foo Boo"}),this},e}();t.default=u},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new s.Promise(function(e,r){function n(o,i){try{var u=t[o](i),a=u.value}catch(e){return void r(e)}return u.done?void e(a):s.Promise.resolve(a).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var s=r(4),u=r(14),a=n(u),c=r(3),p=function(){function e(t,r,n,o,s,u){i(this,e),this._method=t.toUpperCase(),this._path=r,this._json=n||{},this._delay=u||10,this._status=o||200,this._statusText=s||"OK"}return e.prototype.path=function(){return this._path},e.prototype.method=function(){return this._method},e.prototype.test=function(e){return e.url.indexOf(this._path)>-1&&e.method.toUpperCase()==this._method},e.prototype.getResponse=function(){function e(e){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.delay)(this._delay);case 2:return e.abrupt("return",this.createResponse(this._json));case 3:case"end":return e.stop()}},e,this)}));return e}(),e.prototype.createResponse=function(e,t){t=t||{},t.status=t.status||this._status,t.statusText=t.statusText||this._statusText;var r=JSON.stringify(e),n=new s.Response(r,t);return n.headers.set(a.default._contentType,a.default._jsonContentType),n},e}();t.default=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new a.Promise(function(e,r){function n(o,i){try{var s=t[o](i),u=s.value}catch(e){return void r(e)}return s.done?void e(u):a.Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=r(4),c=r(12),p=n(c),h=r(19),f=n(h),l=r(3),d=r(20),y=n(d),_=function(e){function t(r){var n=r.client,o=r.cache,u=r.server,a=r.appKey,c=r.appSecret,p=r.appName,h=r.appVersion,l=r.sdkVersion,d=r.redirectUri;i(this,t);var y=s(this,e.call(this));return y.events={beforeLogin:"beforeLogin",loginSuccess:"loginSuccess",loginError:"loginError",beforeRefresh:"beforeRefresh",refreshSuccess:"refreshSuccess",refreshError:"refreshError",beforeLogout:"beforeLogout",logoutSuccess:"logoutSuccess",logoutError:"logoutError"},y._server=u,y._appKey=a,y._appSecret=c,y._cache=o,y._client=n,y._refreshPromise=null,y._auth=new f.default(y._cache,t._cacheId),y._userAgent=(p?p+(h?"/"+h:"")+" ":"")+"RCJSSDK/"+l,y._redirectUri=d||"",y}return u(t,e),t.prototype.auth=function(){return this._auth},t.prototype.client=function(){return this._client},t.prototype.createUrl=function(e,r){e=e||"",r=r||{};var n="",o=e.indexOf("http://")!=-1||e.indexOf("https://")!=-1;return r.addServer&&!o&&(n+=this._server),e.indexOf(t._urlPrefix)!=-1||o||(n+=t._urlPrefix+"/"+t._apiVersion),n+=e,(r.addMethod||r.addToken)&&(n+=e.indexOf("?")>-1?"&":"?"),r.addMethod&&(n+="_method="+r.addMethod),r.addToken&&(n+=(r.addMethod?"&":"")+"access_token="+this._auth.accessToken()),n},t.prototype.loginUrl=function(e){return e=e||{},this.createUrl(t._authorizeEndpoint+"?"+(0,l.queryStringify)({response_type:e.implicit?"token":"code",redirect_uri:e.redirectUri||this._redirectUri,
client_id:this._appKey,state:e.state||"",brand_id:e.brandId||"",display:e.display||"",prompt:e.prompt||""}),{addServer:!0})},t.prototype.parseLoginRedirect=function(e){function t(e,t){return e.split(t).reverse()[0]}var r=0===e.indexOf("#")&&t(e,"#")||0===e.indexOf("?")&&t(e,"?")||null;if(!r)throw new Error("Unable to parse response");var n=(0,l.parseQueryString)(r);if(!n)throw new Error("Unable to parse response");var o=n.error_description||n.error;if(o){var i=new Error(o);throw i.error=n.error,i}return n},t.prototype.loginWindow=function(e){var t=this;return new a.Promise(function(r,n){if(!(0,l.isBrowser)())throw new Error("This method can be used only in browser");if(!e.url)throw new Error("Missing mandatory URL parameter");e=e||{},e.url=e.url||400,e.width=e.width||400,e.height=e.height||600,e.origin=e.origin||window.location.origin,e.property=e.property||y.default.authResponseProperty,e.target=e.target||"_blank";var o=void 0!=window.screenLeft?window.screenLeft:screen.left,i=void 0!=window.screenTop?window.screenTop:screen.top,s=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,u=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,a=s/2-e.width/2+o,c=u/2-e.height/2+i,p=window.open(e.url,"_blank","_blank"==e.target?"scrollbars=yes, status=yes, width="+e.width+", height="+e.height+", left="+a+", top="+c:"");window.focus&&p.focus();var h=window.addEventListener?"addEventListener":"attachEvent",f="addEventListener"==h?"removeEventListener":"detachEvent",d="addEventListener"==h?"message":"onmessage",_=function o(i){if(i.origin==e.origin&&i.data&&i.data[e.property]){p.close(),window[f](d,o);try{var s=t.parseLoginRedirect(i.data[e.property]);if(!s.code&&!s.access_token)throw new Error("No authorization code or token");r(s)}catch(e){n(e)}}};window[h](d,_,!1)})},t.prototype.loggedIn=function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.ensureLoggedIn();case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",!1);case 9:case"end":return e.stop()}},e,this,[[0,6]])}));return e}(),t.prototype.login=function(){function e(e){return r.apply(this,arguments)}var r=o(regeneratorRuntime.mark(function e(r){var n,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=r||{},this.emit(this.events.beforeLogin),n={},r.code?r.code&&(n.grant_type="authorization_code",n.code=r.code,n.redirect_uri=r.redirectUri||this._redirectUri):(n.grant_type="password",n.username=r.username,n.password=r.password,n.extension=r.extension||""),!r.access_token){e.next=9;break}i=r,e.next=16;break;case 9:return r.endpointId&&(n.endpoint_id=r.endpointId),r.accessTokenTtl&&(n.accessTokenTtl=r.accessTokenTtl),r.refreshTokenTtl&&(n.refreshTokenTtl=r.refreshTokenTtl),e.next=14,this._tokenRequest(t._tokenEndpoint,n);case 14:o=e.sent,i=o.json();case 16:return this._auth.setData(i),this.emit(this.events.loginSuccess,o),e.abrupt("return",o);case 21:throw e.prev=21,e.t0=e.catch(0),this._cache.clean(),this.emit(this.events.loginError,e.t0),e.t0;case 26:case"end":return e.stop()}},e,this,[[0,21]])}));return e}(),t.prototype._refresh=function(){function e(){return r.apply(this,arguments)}var r=o(regeneratorRuntime.mark(function e(){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.emit(this.events.beforeRefresh),e.next=4,(0,l.delay)(t._refreshDelayMs);case 4:if(this._auth.refreshToken()){e.next=6;break}throw new Error("Refresh token is missing");case 6:if(this._auth.refreshTokenValid()){e.next=8;break}throw new Error("Refresh token has expired");case 8:return e.next=10,this._tokenRequest(t._tokenEndpoint,{grant_type:"refresh_token",refresh_token:this._auth.refreshToken(),access_token_ttl:this._auth.data().expires_in+1,refresh_token_ttl:this._auth.data().refresh_token_expires_in+1});case 10:if(r=e.sent,n=r.json(),n.access_token){e.next=14;break}throw this._client.makeError(new Error("Malformed OAuth response"),r);case 14:return this._auth.setData(n),this.emit(this.events.refreshSuccess,r),e.abrupt("return",r);case 19:throw e.prev=19,e.t0=e.catch(0),e.t0=this._client.makeError(e.t0),t._clearCacheOnRefreshError&&this._cache.clean(),this.emit(this.events.refreshError,e.t0),e.t0;case 25:case"end":return e.stop()}},e,this,[[0,19]])}));return e}(),t.prototype.refresh=function(){var e=this;return this._refreshPromise||(this._refreshPromise=this._refresh().then(function(t){return e._refreshPromise=null,t}).catch(function(t){throw e._refreshPromise=null,t})),this._refreshPromise},t.prototype.logout=function(){function e(){return r.apply(this,arguments)}var r=o(regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.emit(this.events.beforeLogout),e.next=4,this._tokenRequest(t._revokeEndpoint,{token:this._auth.accessToken()});case 4:return r=e.sent,this._cache.clean(),this.emit(this.events.logoutSuccess,r),e.abrupt("return",r);case 10:throw e.prev=10,e.t0=e.catch(0),this.emit(this.events.logoutError,e.t0),e.t0;case 14:case"end":return e.stop()}},e,this,[[0,10]])}));return e}(),t.prototype.inflateRequest=function(){function e(e,r){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=r||{},!r.skipAuthCheck){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,this.ensureLoggedIn();case 5:return t.headers.set("X-User-Agent",this._userAgent),t.headers.set("Client-Id",this._appKey),t.headers.set("Authorization",this._authHeader()),e.abrupt("return",t);case 9:case"end":return e.stop()}},e,this)}));return e}(),t.prototype.sendRequest=function(){function e(e,r){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.inflateRequest(t,r);case 3:return t=e.sent,e.next=6,this._client.sendRequest(t);case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(0),e.t0.apiResponse&&e.t0.apiResponse.response()&&401==e.t0.apiResponse.response().status&&!r.retry){e.next=13;break}throw e.t0;case 13:return this._auth.cancelAccessToken(),r.retry=!0,e.next=17,this.sendRequest(t,r);case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}},e,this,[[0,9]])}));return e}(),t.prototype.send=function(){function e(e){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.url=this.createUrl(t.url,{addServer:!0}),e.next=3,this.sendRequest(this._client.createRequest(t),t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return e}(),t.prototype.get=function(){function e(e,r,n){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||{},n.method="GET",n.url=t,n.query=r,e.next=6,this.send(n);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return e}(),t.prototype.post=function(){function e(e,r,n,o){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t,r,n,o){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=o||{},o.method="POST",o.url=t,o.query=n,o.body=r,e.next=7,this.send(o);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return e}(),t.prototype.put=function(){function e(e,r,n,o){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t,r,n,o){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=o||{},o.method="PUT",o.url=t,o.query=n,o.body=r,e.next=7,this.send(o);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return e}(),t.prototype.delete=function(){function e(e,r,n){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t,r,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||{},n.method="DELETE",n.url=t,n.query=r,e.next=6,this.send(n);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,this)}));return e}(),t.prototype._tokenRequest=function(){function e(e,r){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.send({url:t,skipAuthCheck:!0,body:r,method:"POST",headers:{Authorization:"Basic "+this._apiKey(),"Content-Type":"application/x-www-form-urlencoded"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return e}(),t.prototype.ensureLoggedIn=function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isAccessTokenValid()){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.refresh();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return e}(),t.prototype._isAccessTokenValid=function(){return this._auth.accessTokenValid()},t.prototype._apiKey=function(){var e=this._appKey+":"+this._appSecret;return"function"==typeof btoa?btoa(e):new Buffer(e).toString("base64")},t.prototype._authHeader=function(){var e=this._auth.accessToken();return this._auth.tokenType()+(e?" "+e:"")},t}(p.default);_._urlPrefix="/restapi",_._apiVersion="v1.0",_._tokenEndpoint="/restapi/oauth/token",_._revokeEndpoint="/restapi/oauth/revoke",_._authorizeEndpoint="/restapi/oauth/authorize",_._refreshDelayMs=100,_._cacheId="platform",_._clearCacheOnRefreshError=!1,t.default=_},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var n=function(){function e(t,n){r(this,e),this._cache=t,this._cacheId=n}return e.prototype.accessToken=function(){return this.data().access_token},e.prototype.refreshToken=function(){return this.data().refresh_token},e.prototype.tokenType=function(){return this.data().token_type},e.prototype.data=function(){return this._cache.getItem(this._cacheId)||{token_type:"",access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}},e.prototype.setData=function(e){e=e||{};var t=this.data();return Object.keys(e).forEach(function(r){t[r]=e[r]}),t.expire_time=Date.now()+1e3*t.expires_in,t.refresh_token_expire_time=Date.now()+1e3*t.refresh_token_expires_in,this._cache.setItem(this._cacheId,t),this},e.prototype.accessTokenValid=function(){var t=this.data();return t.token_type===e.forcedTokenType||t.expire_time-e.refreshHandicapMs>Date.now()},e.prototype.refreshTokenValid=function(){return this.data().refresh_token_expire_time>Date.now()},e.prototype.cancelAccessToken=function(){return this.setData({access_token:"",expires_in:0})},e.prototype.forceAuthentication=function(){return this.setData({token_type:e.forcedTokenType,access_token:"",expires_in:0,refresh_token:"",refresh_token_expires_in:0}),this},e}();n.refreshHandicapMs=6e4,n.forcedTokenType="forced",t.default=n},function(e,t,r){"use strict";t.__esModule=!0,t.default={authResponseProperty:"RCAuthorizationResponse",version:"3.0.0-rc2"}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=r(22),s=n(i),u=r(4),a=function(){function e(){o(this,e),this.crypto_obj=u.PUBNUB.crypto_obj}return e.prototype.init=function(e){return new s.default(e)},e}();t.default=a},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var u=r(12),a=n(u),c=r(4),p=function(e){function t(r){o(this,t);var n=i(this,e.call(this));return n.options=r,n.crypto_obj=c.PUBNUB.crypto_obj,n}return s(t,e),t.prototype.init=function(e){this.options=e},t.prototype.ready=function(){},t.prototype.subscribe=function(e){this.on("message-"+e.channel,e.message)},t.prototype.unsubscribe=function(e){this.removeAllListeners("message-"+e.channel)},t.prototype.receiveMessage=function(e,t){this.emit("message-"+t,e,"env",t)},t}(a.default);t.default=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,i){try{var s=t[o](i),u=s.value}catch(e){return void r(e)}return s.done?void e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var a=r(12),c=n(a),p=function(e){function t(r,n){i(this,t);var o=s(this,e.call(this));return o.events={notification:"notification",removeSuccess:"removeSuccess",removeError:"removeError",renewSuccess:"renewSuccess",renewError:"renewError",subscribeSuccess:"subscribeSuccess",subscribeError:"subscribeError"},o._pubnubFactory=r,o._platform=n,o._pubnub=null,o._pubnubLastChannel=null,o._timeout=null,o._subscription=null,o}return u(t,e),t.prototype.subscribed=function(){var e=this.subscription();return!!(e.id&&e.deliveryMode&&e.deliveryMode.subscriberKey&&e.deliveryMode.address)},t.prototype.alive=function(){return this.subscribed()&&Date.now()<this.expirationTime()},t.prototype.expired=function(){return!this.subscribed()||(!this.subscribed()||Date.now()>this.subscription().expirationTime)},t.prototype.expirationTime=function(){return new Date(this.subscription().expirationTime||0).getTime()-t._renewHandicapMs},t.prototype.setSubscription=function(e){return e=e||{},this._clearTimeout(),this._setSubscription(e),this._subscribeAtPubnub(),this._setTimeout(),this},t.prototype.subscription=function(){return this._subscription||{}},t.prototype.register=function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alive()){e.next=6;break}return e.next=3,this.renew();case 3:return e.abrupt("return",e.sent);case 6:return e.next=8,this.subscribe();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e,this)}));return e}(),t.prototype.eventFilters=function(){return this.subscription().eventFilters||[]},t.prototype.addEventFilters=function(e){return this.setEventFilters(this.eventFilters().concat(e)),this},t.prototype.setEventFilters=function(e){var t=this.subscription();return t.eventFilters=e,this._setSubscription(t),this},t.prototype.subscribe=function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this._clearTimeout(),this.eventFilters().length){e.next=4;break}throw new Error("Events are undefined");case 4:return e.next=6,this._platform.post("/subscription",{eventFilters:this._getFullEventFilters(),deliveryMode:{transportType:"PubNub"}});case 6:return t=e.sent,r=t.json(),this.setSubscription(r).emit(this.events.subscribeSuccess,t),e.abrupt("return",t);case 12:throw e.prev=12,e.t0=e.catch(0),e.t0=this._platform.client().makeError(e.t0),this.reset().emit(this.events.subscribeError,e.t0),e.t0;case 17:case"end":return e.stop()}},e,this,[[0,12]])}));return e}(),t.prototype.renew=function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this._clearTimeout(),this.subscribed()){e.next=4;break}throw new Error("No subscription");case 4:if(this.eventFilters().length){e.next=6;break}throw new Error("Events are undefined");case 6:return e.next=8,this._platform.put("/subscription/"+this.subscription().id,{eventFilters:this._getFullEventFilters()});case 8:return t=e.sent,r=t.json(),this.setSubscription(r).emit(this.events.renewSuccess,t),e.abrupt("return",t);case 14:throw e.prev=14,e.t0=e.catch(0),e.t0=this._platform.client().makeError(e.t0),this.reset().emit(this.events.renewError,e.t0),e.t0;case 19:case"end":return e.stop()}},e,this,[[0,14]])}));return e}(),t.prototype.remove=function(){function e(){return t.apply(this,arguments)}var t=o(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.subscribed()){e.next=3;break}throw new Error("No subscription");case 3:return e.next=5,this._platform.delete("/subscription/"+this.subscription().id);case 5:return t=e.sent,this.reset().emit(this.events.removeSuccess,t),e.abrupt("return",t);case 10:throw e.prev=10,e.t0=e.catch(0),e.t0=this._platform.client().makeError(e.t0),this.emit(this.events.removeError,e.t0),e.t0;case 15:case"end":return e.stop()}},e,this,[[0,10]])}));return e}(),t.prototype.resubscribe=function(){var e=this.eventFilters();return this.reset().setEventFilters(e).subscribe()},t.prototype.reset=function(){return this._clearTimeout(),this.subscribed()&&this._pubnub&&this._pubnub.unsubscribe({channel:this.subscription().deliveryMode.address}),this._setSubscription(null),this},t.prototype._setSubscription=function(e){this._subscription=e},t.prototype._getFullEventFilters=function(){var e=this;return this.eventFilters().map(function(t){return e._platform.createUrl(t)})},t.prototype._setTimeout=function(){var e=this;if(this._clearTimeout(),!this.alive())throw new Error("Subscription is not alive");return this._timeout=setInterval(function(){e.alive()||(e.expired()?e.subscribe():e.renew())},t._pollInterval),this},t.prototype._clearTimeout=function(){return clearInterval(this._timeout),this},t.prototype._decrypt=function(e){if(!this.subscribed())throw new Error("No subscription");return this.subscription().deliveryMode.encryptionKey&&(e=this._pubnubFactory.crypto_obj.decrypt(e,this.subscription().deliveryMode.encryptionKey,{encryptKey:!1,keyEncoding:"base64",keyLength:128,mode:"ecb"})),e},t.prototype._notify=function(e){return this.emit(this.events.notification,this._decrypt(e)),this},t.prototype._subscribeAtPubnub=function(){if(!this.alive())throw new Error("Subscription is not alive");var e=this.subscription().deliveryMode;if(this._pubnub){if(this._pubnubLastChannel==e.address)return this;this._pubnubLastChannel&&this._pubnub.unsubscribe({channel:this._pubnubLastChannel}),this._pubnub=this._pubnub.init({ssl:!0,subscribe_key:e.subscriberKey})}else this._pubnub=this._pubnubFactory.init({ssl:!0,subscribe_key:e.subscriberKey}),this._pubnub.ready();return this._pubnubLastChannel=e.address,this._pubnub.subscribe({channel:e.address,message:this._notify.bind(this),connect:function(){}}),this},t}(c.default);p._renewHandicapMs=12e4,p._pollInterval=1e4,t.default=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}t.__esModule=!0;var u=r(23),a=n(u),c=function(e){function t(r,n,s,u){o(this,t);var a=i(this,e.call(this,r,n));return a._cache=s,a._cacheKey=u,a}return s(t,e),t.prototype.subscription=function(){return this._cache.getItem(this._cacheKey)||{}},t.prototype._setSubscription=function(e){return this._cache.setItem(this._cacheKey,e)},t.prototype.restore=function(e){return this.eventFilters().length||this.setEventFilters(e),this},t}(a.default);t.default=c}])});
//# sourceMappingURL=ringcentral.min.js.map